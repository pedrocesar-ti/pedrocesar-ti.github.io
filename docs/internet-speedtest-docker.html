<!DOCTYPE HTML>
<html lang="en" >
    
    <head>
        
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <title>internet-speedtest-docker | Pedro César de Azevedo!</title>
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="generator" content="GitBook 2.4.3">
        
        
        <meta name="HandheldFriendly" content="true"/>
        <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-status-bar-style" content="black">
        <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
        <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">
        
    <link rel="stylesheet" href="../gitbook/style.css">
    
    
        <link rel="stylesheet" href="../docs/styles/website.css">
    

        
    
    
    <link rel="next" href="../docs/Xenv-jenkins-lib.html" />
    
    
    <link rel="prev" href="../index.html" />
    

        
    </head>
    <body>
        
        
    <div class="book" data-level="1" data-basepath=".." data-revision="Wed Nov 27 2019 10:54:48 GMT+0000 (UTC)">
    

<div class="book-summary">
    <div class="book-search" role="search">
        <input type="text" placeholder="Type to search" class="form-control" />
    </div>
    <nav role="navigation">
        <ul class="summary">
            
            
            
            

            

            
    
        <li class="chapter " data-level="0" data-path="index.html">
            
                
                    <a href="../index.html">
                
                        <i class="fa fa-check"></i>
                        
                        Introduction
                    </a>
            
            
        </li>
    
        <li class="chapter active" data-level="1" data-path="docs/internet-speedtest-docker.html">
            
                
                    <a href="../docs/internet-speedtest-docker.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>1.</b>
                        
                        internet-speedtest-docker
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="2" data-path="docs/Xenv-jenkins-lib.html">
            
                
                    <a href="../docs/Xenv-jenkins-lib.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>2.</b>
                        
                        Xenv-jenkins-lib
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="3" data-path="docs/hubot-slack-docker.html">
            
                
                    <a href="../docs/hubot-slack-docker.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>3.</b>
                        
                        hubot-slack-docker
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="4" data-path="docs/machine.html">
            
                
                    <a href="../docs/machine.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>4.</b>
                        
                        machine
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="5" data-path="docs/bash-facilities.html">
            
                
                    <a href="../docs/bash-facilities.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>5.</b>
                        
                        bash-facilities
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="6" data-path="docs/Vimfiles.html">
            
                
                    <a href="../docs/Vimfiles.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>6.</b>
                        
                        Vimfiles
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="7" data-path="docs/jmeter-docker.html">
            
                
                    <a href="../docs/jmeter-docker.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>7.</b>
                        
                        jmeter-docker
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="8" data-path="docs/my-alexa-skills.html">
            
                
                    <a href="../docs/my-alexa-skills.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>8.</b>
                        
                        my-alexa-skills
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="9" data-path="docs/rasp-iot-bot.html">
            
                
                    <a href="../docs/rasp-iot-bot.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>9.</b>
                        
                        rasp-iot-bot
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="10" data-path="docs/shellscripting.html">
            
                
                    <a href="../docs/shellscripting.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>10.</b>
                        
                        shellscripting
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="11" data-path="docs/javascript-mean-docker.html">
            
                
                    <a href="../docs/javascript-mean-docker.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>11.</b>
                        
                        javascript-mean-docker
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="12" data-path="docs/jenkins-docker-slave.html">
            
                
                    <a href="../docs/jenkins-docker-slave.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>12.</b>
                        
                        jenkins-docker-slave
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="13" data-path="docs/snm-cm-docker.html">
            
                
                    <a href="../docs/snm-cm-docker.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>13.</b>
                        
                        monitor-stack-docker
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="14" data-path="docs/janky-docker.html">
            
                
                    <a href="../docs/janky-docker.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>14.</b>
                        
                        janky-docker
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="15" data-path="docs/slate-docker.html">
            
                
                    <a href="../docs/slate-docker.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>15.</b>
                        
                        slate-docker
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="16" data-path="docs/puppet-br-certification.html">
            
                
                    <a href="../docs/puppet-br-certification.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>16.</b>
                        
                        puppet-br-certification
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="17" data-path="docs/puppet-br.org-octopress.html">
            
                
                    <a href="../docs/puppet-br.org-octopress.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>17.</b>
                        
                        puppet-br
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="18" data-path="docs/node-teamcity-api.html">
            
                
                    <a href="../docs/node-teamcity-api.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>18.</b>
                        
                        node-teamcity-api
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="19" data-path="docs/charts.html">
            
                
                    <a href="../docs/charts.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>19.</b>
                        
                        charts
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="20" data-path="docs/distributed-jmeter-docker.html">
            
                
                    <a href="../docs/distributed-jmeter-docker.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>20.</b>
                        
                        distributed-jmeter-docker
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="21" data-path="docs/my-docker-ui.html">
            
                
                    <a href="../docs/my-docker-ui.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>21.</b>
                        
                        my-docker-ui
                    </a>
            
            
        </li>
    
        <li class="chapter " data-level="22" data-path="docs/vimeo-scraper-docker.html">
            
                
                    <a href="../docs/vimeo-scraper-docker.html">
                
                        <i class="fa fa-check"></i>
                        
                            <b>22.</b>
                        
                        vimeo-scraper-docker
                    </a>
            
            
        </li>
    


            
            <li class="divider"></li>
            <li>
                <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
                    Published with GitBook
                </a>
            </li>
            
        </ul>
    </nav>
</div>

    <div class="book-body">
        <div class="body-inner">
            <div class="book-header" role="navigation">
    <!-- Actions Left -->
    <a href="#" class="btn pull-left toggle-summary" aria-label="Table of Contents"><i class="fa fa-align-justify"></i></a>
    <a href="#" class="btn pull-left toggle-search" aria-label="Search"><i class="fa fa-search"></i></a>
    
    <div id="font-settings-wrapper" class="dropdown pull-left">
        <a href="#" class="btn toggle-dropdown" aria-label="Font Settings"><i class="fa fa-font"></i>
        </a>
        <div class="dropdown-menu font-settings">
    <div class="dropdown-caret">
        <span class="caret-outer"></span>
        <span class="caret-inner"></span>
    </div>

    <div class="buttons">
        <button type="button" id="reduce-font-size" class="button size-2">A</button>
        <button type="button" id="enlarge-font-size" class="button size-2">A</button>
    </div>

    <div class="buttons font-family-list">
        <button type="button" data-font="0" class="button">Serif</button>
        <button type="button" data-font="1" class="button">Sans</button>
    </div>

    <div class="buttons color-theme-list">
        <button type="button" id="color-theme-preview-0" class="button size-3" data-theme="0">White</button>
        <button type="button" id="color-theme-preview-1" class="button size-3" data-theme="1">Sepia</button>
        <button type="button" id="color-theme-preview-2" class="button size-3" data-theme="2">Night</button>
    </div>
</div>

    </div>

    <!-- Actions Right -->
    
    <div class="dropdown pull-right">
        <a href="#" class="btn toggle-dropdown" aria-label="Share"><i class="fa fa-share-alt"></i>
        </a>
        <div class="dropdown-menu font-settings dropdown-left">
            <div class="dropdown-caret">
                <span class="caret-outer"></span>
                <span class="caret-inner"></span>
            </div>
            <div class="buttons">
                <button type="button" data-sharing="twitter" class="button">
                    Share on Twitter
                </button>
                <button type="button" data-sharing="google-plus" class="button">
                    Share on Google
                </button>
                <button type="button" data-sharing="facebook" class="button">
                    Share on Facebook
                </button>
                <button type="button" data-sharing="weibo" class="button">
                    Share on Weibo
                </button>
                <button type="button" data-sharing="instapaper" class="button">
                    Share on Instapaper
                </button>
            </div>
        </div>
    </div>
    

    
    <a href="#" target="_blank" class="btn pull-right google-plus-sharing-link sharing-link" data-sharing="google-plus" aria-label="Google"><i class="fa fa-google-plus"></i></a>
    
    
    <a href="#" target="_blank" class="btn pull-right facebook-sharing-link sharing-link" data-sharing="facebook" aria-label="Facebook"><i class="fa fa-facebook"></i></a>
    
    
    <a href="#" target="_blank" class="btn pull-right twitter-sharing-link sharing-link" data-sharing="twitter" aria-label="Twitter"><i class="fa fa-twitter"></i></a>
    
    
    


    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="../" >Pedro César de Azevedo!</a>
    </h1>
</div>

            <div class="page-wrapper" tabindex="-1" role="main">
                <div class="page-inner">
                
                
                    <section class="normal" id="section-">
                    
                        <h1 id="internet-speedtest-docker">internet-speedtest-docker</h1>
<p><strong><strong>Spoiler Alert</strong></strong></p>
<p>This project won&apos;t help you with your connection, actually this project born when I need to monitoring the speed of my Internet, create a report to send to my ISP, so they can take some action. Using <strong>Docker Compose</strong> I put together three containers with the tools needed to monitoring and display the status of your Internet (and I know that tool can do more or can be better).</p>
<p>Here in Brazil is a mess to contract a good ISP, they just don&apos;t deliver the speed they should for the users. Generally in a small business or a residence you can&apos;t pay for a very expensive plans where they certify the bandwidth delivered. So you have to call them many times complaining about the speed of your internet connection and always they will ask you to do that Internet Tests Online, such as <a href="http://www.speedtest.net" target="_blank">SpeedTest</a>, <a href="http://www.att.com/speedtest/" target="_blank">AT&amp;T SpeedTest</a>, <a href="http://testmy.net" target="_blank">TestMyNet</a>, most of these tests are based only on ICMP messages that don&apos;t reflect your real bandwidth at that time. Or even worse your ISP can allow all trafic ICMP so when you test it appears that you have a good speed but when you have to download some content you can&apos;t do it that well. There is much more to talk about it but I don&apos;t wanna spend so much time talking about the things that are wrong here.</p>
<p align="center"><img src="https://dl.dropboxusercontent.com/s/l0py4zgi5izcbgw/Screen%20Shot%202017-02-27%20at%2023.55.16.png" Grafana"=""></p>

<h2 id="running-container">Running container</h2>
<p>The only requirement to run this compose is have Docker Compose installed, if you need to install you can <a href="https://docs.docker.com/compose/install/" target="_blank">click here</a> to check out how can you do that. After installed the only thing you need is export the variables that you like and configure the volume for persistent data, then run the compose as command available below:</p>
<pre><code class="lang-console">$ git clone https://github.com/pedrocesar-ti/internet-speedtest-docker.git
$ cd internet-speedtest-docker

$ docker-compose up -d
</code></pre>
<h2 id="docker-compose">Docker Compose</h2>
<p>As you probably know Docker Compose is a tool to let you running a multi-container application, so as I sad before I put together some contaiers to make everything work together. They are described below:</p>
<h3 id="influxdb-db">InfluxDB (DB)</h3>
<p>InfluxDB is a database tool based on time-series, so every event is registrate with their timestamp. I decided to use InfluxDB at first because has great integration with Grafana and second I don&apos;t take cara about timestamp and how generate the graphs based on time.</p>
<p align="center"><img src="https://dl.dropboxusercontent.com/s/u8urqvu85ob8zdn/Screen%20Shot%202017-02-28%20at%2000.03.36.png" InfluxDB"=""></p>

<p>This project uses the official InfluxDB image hosted in the Docker Hub Library.</p>
<p>You can edit or remove the volumes section of the docker-compose.yml file to reflect where you want you persistent data to live, or you can remove it if you like.   If you remove the volume mount you will lose all of your data if the container is removed.</p>
<pre><code class="lang-docker-compose.yml">services:
  db:
    image: influxdb 
    container_name: influxdb
    volumes:
      - &quot;/data/influxdb/:/var/lib/influxdb&quot;
</code></pre>
<p>You can customize some actions with variables listed below:</p>
<table>
<thead>
<tr>
<th>Variables</th>
<th>Default</th>
<th>Function</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>INFLUXDB_ADMIN_USER</strong></td>
<td>admin</td>
<td>Set root user for the database.</td>
</tr>
<tr>
<td><strong>INFLUXDB_ADMIN_PASSWORD</strong></td>
<td>password</td>
<td>Set the password for the root user.</td>
</tr>
<tr>
<td><strong>INFLUXDB_DB</strong></td>
<td>speedtest</td>
<td>Create a database <strong>speedtest</strong> when container starts.</td>
</tr>
</tbody>
</table>
<h3 id="grafana-web">Grafana (Web)</h3>
<p>Grafana is a tool to create and manage dashboards and graphs. It&apos;s a really cool tool and as I said earlier has a perfect integration with InfluxDB.</p>
<p>When I started this project I used <a href="https://github.com/tutumcloud/grafana" target="_blank">tutumcloud/grafana</a> image, however they stopped to update grafana image beacause the new version has a different way to be installed, so it&apos;s deprecated. So I used <a href="https://hub.docker.com/r/grafana/grafana/" target="_blank">grafana</a> original image as a base system to generate my own image.</p>
<p>You can also customize this image with few variables:</p>
<table>
<thead>
<tr>
<th>Variables</th>
<th>Default</th>
<th>Function</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>GF_SERVER_ROOT</strong></td>
<td><a href="http://localhost" target="_blank">http://localhost</a></td>
<td>Set URL to configure Grafana built-in web server.</td>
</tr>
<tr>
<td><strong>GF_SECURITY_ADMIN_PASSWORD</strong></td>
<td><strong>Default without password.</strong></td>
<td>This is a password to access the Grafana Dashboard.</td>
</tr>
</tbody>
</table>
<h3 id="speedtest-testing">SpeedTest (Testing)</h3>
<p>This image was created to run a script that calls speedtest-cli to test the internet connect and save data on InfluxDB. <a href="https://github.com/sivel/speedtest-cli/" target="_blank">SpeedTest</a> is a tool written in Python and is used to test your Internet connection based on download and upload some content from servers configured previously (in average this test takes around 30 sec, at least in my case).</p>
<p>The only variable to customize on this image is a variable to set the frequency that this script will run in seconds. So if you need your test to run every minute, change the variable to 60 seconds. Just bear in mind that the speed test execution time will be added on top of the test interval so you might end up with data points every 1 minute and something. </p>
<p>If you are using docker-compose to standup you stack you can easily change the variable value on the <a href="env/testing.env">env/testing.env</a> file.</p>
<table>
<thead>
<tr>
<th>Variables</th>
<th>Default</th>
<th>Function</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>TEST_INTERVAL</strong></td>
<td>5</td>
<td>Time (in sec.) to set how long will sleep the script until run again.</td>
</tr>
</tbody>
</table>
<h2 id="repositories-used-to">Repositories used to</h2>
<ul>
<li><a href="https://hub.docker.com/_/influxdb/" target="_blank">influxdb</a> </li>
<li><a href="https://hub.docker.com/r/grafana/grafana/" target="_blank">Grafana</a></li>
<li><a href="https://github.com/sivel/speedtest-cli/" target="_blank">SpeedTest</a></li>
</ul>
<p>Enjoy! :)</p>

                    
                    </section>
                
                
                </div>
            </div>
        </div>

        
        <a href="../index.html" class="navigation navigation-prev " aria-label="Previous page: Introduction"><i class="fa fa-angle-left"></i></a>
        
        
        <a href="../docs/Xenv-jenkins-lib.html" class="navigation navigation-next " aria-label="Next page: Xenv-jenkins-lib"><i class="fa fa-angle-right"></i></a>
        
    </div>
</div>

        
<script src="../gitbook/app.js"></script>

    
    <script src="../gitbook/plugins/gitbook-plugin-github/plugin.js"></script>
    

<script>
require(["gitbook"], function(gitbook) {
    var config = {"fontSettings":{"theme":null,"family":"sans","size":2},"github":{"url":"https://github.com/pedrocesar-ti"}};
    gitbook.start(config);
});
</script>

        
    </body>
    
</html>
